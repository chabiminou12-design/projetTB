@model List<Stat.Models.ViewModels.DIWUsersViewModel>
@{
    ViewData["Title"] = "Liste des DIWs Gérés";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container-fluid px-4">
    <h1 class="mt-4">@ViewData["Title"]</h1>
    <ol class="breadcrumb mb-4">
        <li class="breadcrumb-item"><a asp-action="Index">Tableau de Bord</a></li>
        <li class="breadcrumb-item active">@ViewData["Title"]</li>
    </ol>

    <div class="card mb-4">
        <div class="card-header">
            <i class="fas fa-building me-1"></i>
            DIWs sous votre supervision
        </div>
        <div class="card-body">
            @if (Model.Any())
            {
                <div class="accordion" id="diwAccordion">
                    @foreach (var (diw, index) in Model.Select((value, i) => (value, i)))
                    {
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="heading-@diw.CodeDIW">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-@diw.CodeDIW" aria-expanded="false" aria-controls="collapse-@diw.CodeDIW">
                                    <strong>@diw.LibelleDIW</strong>&nbsp;(@diw.CodeDIW)
                                    <span class="badge bg-primary rounded-pill ms-3">@diw.Users.Count Utilisateur(s)</span>
                                </button>
                            </h2>
                            <div id="collapse-@diw.CodeDIW" class="accordion-collapse collapse" aria-labelledby="heading-@diw.CodeDIW" data-bs-parent="#diwAccordion">
                                <div class="accordion-body">
                                    @if (diw.Users.Any())
                                    {
                                        <table class="table table-sm table-striped table-hover">
                                            <thead>
                                                <tr>
                                                    <th>Nom Complet</th>
                                                    <th>Email</th>
                                                    <th>Téléphone</th>
                                                    <th>Dernière Connexion</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                @foreach (var user in diw.Users)
                                                {
                                                    <tr>
                                                        <td>@user.FullName</td>
                                                        <td>@user.Email</td>
                                                        <td>@user.Phone</td>
                                                        <td>@(user.LastConnection?.ToString("dd/MM/yyyy HH:mm") ?? "Jamais connecté")</td>
                                                    </tr>
                                                }
                                            </tbody>
                                        </table>
                                    }
                                    else
                                    {
                                        <p class="text-muted mb-0">Aucun utilisateur n'est assigné à ce DIW.</p>
                                    }
                                </div>
                            </div>
                        </div>
                    }
                </div>
            }
            else
            {
                <p class="text-center text-muted">Aucun DIW n'est actuellement sous votre gestion.</p>
            }
        </div>
    </div>
</div>